## Установка

### Установка как системный сервис

Для запуска приложения как демон в Ubuntu используйте следующие скрипты:

1. **redirector.service** - конфигурационный файл systemd для запуска сервиса.

2. **install-service.sh** - скрипт для установки сервиса:
   ```bash
   chmod +x install-service.sh
   sudo ./install-service.sh
   ```
   Этот скрипт:
   - Проверяет наличие исполняемого файла `redirector`
   - Создает директорию `/opt/redirector`
   - Копирует необходимые файлы (исполняемый файл, конфигурацию, шаблоны)
   - Устанавливает правильные права доступа
   - Регистрирует и запускает systemd сервис

После установки сервис будет автоматически запускаться при загрузке системы. Управление сервисом:

```bash
sudo systemctl start redirector    # запустить сервис
sudo systemctl stop redirector     # остановить сервис
sudo systemctl restart redirector  # перезапустить сервис
sudo systemctl status redirector   # посмотреть статус сервиса
sudo journalctl -u redirector      # просмотреть логи сервиса
```

## Конфигурация

Настройки хранятся в файле `config.yaml`:

```yaml
port: 8080  # Порт сервера
domains:
  example.com:  # Домен
    base_redirect_url: "https://example.com"  # URL для перенаправления при неудачной валидации
    expect_bot_param: "request_hash"  # Параметр запроса для валидации
    expect_bot_value: "example_hash_value"  # Ожидаемое значение параметра
    bot_cookie_name: "visit"  # Имя куки для валидации
    bot_cookie_value: "cookie_value"  # Значение куки
    page_template: "index%d.html"  # Шаблон для генерации страниц
    min_redirect_seconds: 3  # Минимальное время до перенаправления
    max_redirect_seconds: 5  # Максимальное время до перенаправления
  another-domain.com:
    # Аналогичные настройки для другого домена
    ...
```

## Принцип работы

1. Сервис определяет домен из заголовка запроса
2. Загружает конфигурацию для этого домена
3. Проверяет валидацию посетителя (параметр запроса или куки)
4. При успешной валидации отображает страницу и устанавливает куки
5. Страница автоматически перенаправляет на случайную страницу через заданный интервал времени

## Endpoints

- `/` - Основная точка входа
- `/index{id}.html` - Динамические страницы

## Обновление конфигурации

Изменения в файле `config.yaml` применяются автоматически без перезапуска сервиса. Можно добавлять новые домены, изменять настройки существующих и т.д. 